package tests

import (
	"io/ioutil"
	"net"
	"os"
	"path/filepath"
	"testing"
	"time"

	"fmt"

	"github.com/influxdata/influxdb/cmd/influxd/backup"
	"github.com/influxdata/influxdb/cmd/influxd/restore"
	"github.com/influxdata/influxdb/toml"
	"strings"
)

func TestServer_BackupAndRestore(t *testing.T) {
	config := NewConfig()
	config.Data.Engine = "tsm1"
	config.BindAddress = freePort()
	config.Monitor.StoreEnabled = true
	config.Monitor.StoreInterval = toml.Duration(time.Second)

	fullBackupDir, _ := ioutil.TempDir("", "backup")
	defer os.RemoveAll(fullBackupDir)

	partialBackupDir, _ := ioutil.TempDir("", "backup")
	defer os.RemoveAll(partialBackupDir)

	portableBackupDir, _ := ioutil.TempDir("", "backup")
	defer os.RemoveAll(portableBackupDir)

	db := "mydb"
	rp := "forever"
	expected := `{"results":[{"statement_id":0,"series":[{"name":"myseries","columns":["time","host","value"],"values":[["1970-01-01T00:00:00.001Z","A",23],["1970-01-01T00:00:00.005Z","B",24],["1970-01-01T00:00:00.006Z","C",22],["1970-01-01T00:00:00.007Z","C",23],["1970-01-01T00:00:00.008Z","C",24],["1970-01-01T00:00:00.009Z","C",25]]}]}]}`
	partialExpected := `{"results":[{"statement_id":0,"series":[{"name":"myseries","columns":["time","host","value"],"values":[["1970-01-01T00:00:00.001Z","A",23],["1970-01-01T00:00:00.005Z","B",24],["1970-01-01T00:00:00.006Z","C",22],["1970-01-01T00:00:00.007Z","C",23],["1970-01-01T00:00:00.008Z","C",24],["1970-01-01T00:00:00.009Z","C",0],["1970-01-01T00:00:00.009000001Z","C",1],["1970-01-01T00:00:00.009000002Z","C",2],["1970-01-01T00:00:00.009000003Z","C",3],["1970-01-01T00:00:00.009000004Z","C",4],["1970-01-01T00:00:00.009000005Z","C",5],["1970-01-01T00:00:00.009000006Z","C",6],["1970-01-01T00:00:00.009000007Z","C",7],["1970-01-01T00:00:00.009000008Z","C",8],["1970-01-01T00:00:00.009000009Z","C",9],["1970-01-01T00:00:00.00900001Z","C",10],["1970-01-01T00:00:00.009000011Z","C",11],["1970-01-01T00:00:00.009000012Z","C",12],["1970-01-01T00:00:00.009000013Z","C",13],["1970-01-01T00:00:00.009000014Z","C",14],["1970-01-01T00:00:00.009000015Z","C",15],["1970-01-01T00:00:00.009000016Z","C",16],["1970-01-01T00:00:00.009000017Z","C",17],["1970-01-01T00:00:00.009000018Z","C",18],["1970-01-01T00:00:00.009000019Z","C",19],["1970-01-01T00:00:00.00900002Z","C",20],["1970-01-01T00:00:00.009000021Z","C",21],["1970-01-01T00:00:00.009000022Z","C",22],["1970-01-01T00:00:00.009000023Z","C",23],["1970-01-01T00:00:00.009000024Z","C",24],["1970-01-01T00:00:00.009000025Z","C",25],["1970-01-01T00:00:00.009000026Z","C",26],["1970-01-01T00:00:00.009000027Z","C",27],["1970-01-01T00:00:00.009000028Z","C",28],["1970-01-01T00:00:00.009000029Z","C",29],["1970-01-01T00:00:00.00900003Z","C",30],["1970-01-01T00:00:00.009000031Z","C",31],["1970-01-01T00:00:00.009000032Z","C",32],["1970-01-01T00:00:00.009000033Z","C",33],["1970-01-01T00:00:00.009000034Z","C",34],["1970-01-01T00:00:00.009000035Z","C",35],["1970-01-01T00:00:00.009000036Z","C",36],["1970-01-01T00:00:00.009000037Z","C",37],["1970-01-01T00:00:00.009000038Z","C",38],["1970-01-01T00:00:00.009000039Z","C",39],["1970-01-01T00:00:00.00900004Z","C",40],["1970-01-01T00:00:00.009000041Z","C",41],["1970-01-01T00:00:00.009000042Z","C",42],["1970-01-01T00:00:00.009000043Z","C",43],["1970-01-01T00:00:00.009000044Z","C",44],["1970-01-01T00:00:00.009000045Z","C",45],["1970-01-01T00:00:00.009000046Z","C",46],["1970-01-01T00:00:00.009000047Z","C",47],["1970-01-01T00:00:00.009000048Z","C",48],["1970-01-01T00:00:00.009000049Z","C",49],["1970-01-01T00:00:00.00900005Z","C",50],["1970-01-01T00:00:00.009000051Z","C",51],["1970-01-01T00:00:00.009000052Z","C",52],["1970-01-01T00:00:00.009000053Z","C",53],["1970-01-01T00:00:00.009000054Z","C",54],["1970-01-01T00:00:00.009000055Z","C",55],["1970-01-01T00:00:00.009000056Z","C",56],["1970-01-01T00:00:00.009000057Z","C",57],["1970-01-01T00:00:00.009000058Z","C",58],["1970-01-01T00:00:00.009000059Z","C",59],["1970-01-01T00:00:00.00900006Z","C",60],["1970-01-01T00:00:00.009000061Z","C",61],["1970-01-01T00:00:00.009000062Z","C",62],["1970-01-01T00:00:00.009000063Z","C",63],["1970-01-01T00:00:00.009000064Z","C",64],["1970-01-01T00:00:00.009000065Z","C",65],["1970-01-01T00:00:00.009000066Z","C",66],["1970-01-01T00:00:00.009000067Z","C",67],["1970-01-01T00:00:00.009000068Z","C",68],["1970-01-01T00:00:00.009000069Z","C",69],["1970-01-01T00:00:00.00900007Z","C",70],["1970-01-01T00:00:00.009000071Z","C",71],["1970-01-01T00:00:00.009000072Z","C",72],["1970-01-01T00:00:00.009000073Z","C",73],["1970-01-01T00:00:00.009000074Z","C",74],["1970-01-01T00:00:00.009000075Z","C",75],["1970-01-01T00:00:00.009000076Z","C",76],["1970-01-01T00:00:00.009000077Z","C",77],["1970-01-01T00:00:00.009000078Z","C",78],["1970-01-01T00:00:00.009000079Z","C",79],["1970-01-01T00:00:00.00900008Z","C",80],["1970-01-01T00:00:00.009000081Z","C",81],["1970-01-01T00:00:00.009000082Z","C",82],["1970-01-01T00:00:00.009000083Z","C",83],["1970-01-01T00:00:00.009000084Z","C",84],["1970-01-01T00:00:00.009000085Z","C",85],["1970-01-01T00:00:00.009000086Z","C",86],["1970-01-01T00:00:00.009000087Z","C",87],["1970-01-01T00:00:00.009000088Z","C",88],["1970-01-01T00:00:00.009000089Z","C",89],["1970-01-01T00:00:00.00900009Z","C",90],["1970-01-01T00:00:00.009000091Z","C",91],["1970-01-01T00:00:00.009000092Z","C",92],["1970-01-01T00:00:00.009000093Z","C",93],["1970-01-01T00:00:00.009000094Z","C",94],["1970-01-01T00:00:00.009000095Z","C",95],["1970-01-01T00:00:00.009000096Z","C",96],["1970-01-01T00:00:00.009000097Z","C",97],["1970-01-01T00:00:00.009000098Z","C",98],["1970-01-01T00:00:00.009000099Z","C",99],["1970-01-01T00:00:00.0090001Z","C",100],["1970-01-01T00:00:00.009000101Z","C",101],["1970-01-01T00:00:00.009000102Z","C",102],["1970-01-01T00:00:00.009000103Z","C",103],["1970-01-01T00:00:00.009000104Z","C",104],["1970-01-01T00:00:00.009000105Z","C",105],["1970-01-01T00:00:00.009000106Z","C",106],["1970-01-01T00:00:00.009000107Z","C",107],["1970-01-01T00:00:00.009000108Z","C",108],["1970-01-01T00:00:00.009000109Z","C",109],["1970-01-01T00:00:00.00900011Z","C",110],["1970-01-01T00:00:00.009000111Z","C",111],["1970-01-01T00:00:00.009000112Z","C",112],["1970-01-01T00:00:00.009000113Z","C",113],["1970-01-01T00:00:00.009000114Z","C",114],["1970-01-01T00:00:00.009000115Z","C",115],["1970-01-01T00:00:00.009000116Z","C",116],["1970-01-01T00:00:00.009000117Z","C",117],["1970-01-01T00:00:00.009000118Z","C",118],["1970-01-01T00:00:00.009000119Z","C",119],["1970-01-01T00:00:00.00900012Z","C",120],["1970-01-01T00:00:00.009000121Z","C",121],["1970-01-01T00:00:00.009000122Z","C",122],["1970-01-01T00:00:00.009000123Z","C",123],["1970-01-01T00:00:00.009000124Z","C",124],["1970-01-01T00:00:00.009000125Z","C",125],["1970-01-01T00:00:00.009000126Z","C",126],["1970-01-01T00:00:00.009000127Z","C",127],["1970-01-01T00:00:00.009000128Z","C",128],["1970-01-01T00:00:00.009000129Z","C",129],["1970-01-01T00:00:00.00900013Z","C",130],["1970-01-01T00:00:00.009000131Z","C",131],["1970-01-01T00:00:00.009000132Z","C",132],["1970-01-01T00:00:00.009000133Z","C",133],["1970-01-01T00:00:00.009000134Z","C",134],["1970-01-01T00:00:00.009000135Z","C",135],["1970-01-01T00:00:00.009000136Z","C",136],["1970-01-01T00:00:00.009000137Z","C",137],["1970-01-01T00:00:00.009000138Z","C",138],["1970-01-01T00:00:00.009000139Z","C",139],["1970-01-01T00:00:00.00900014Z","C",140],["1970-01-01T00:00:00.009000141Z","C",141],["1970-01-01T00:00:00.009000142Z","C",142],["1970-01-01T00:00:00.009000143Z","C",143],["1970-01-01T00:00:00.009000144Z","C",144],["1970-01-01T00:00:00.009000145Z","C",145],["1970-01-01T00:00:00.009000146Z","C",146],["1970-01-01T00:00:00.009000147Z","C",147],["1970-01-01T00:00:00.009000148Z","C",148],["1970-01-01T00:00:00.009000149Z","C",149],["1970-01-01T00:00:00.00900015Z","C",150],["1970-01-01T00:00:00.009000151Z","C",151],["1970-01-01T00:00:00.009000152Z","C",152],["1970-01-01T00:00:00.009000153Z","C",153],["1970-01-01T00:00:00.009000154Z","C",154],["1970-01-01T00:00:00.009000155Z","C",155],["1970-01-01T00:00:00.009000156Z","C",156],["1970-01-01T00:00:00.009000157Z","C",157],["1970-01-01T00:00:00.009000158Z","C",158],["1970-01-01T00:00:00.009000159Z","C",159],["1970-01-01T00:00:00.00900016Z","C",160],["1970-01-01T00:00:00.009000161Z","C",161],["1970-01-01T00:00:00.009000162Z","C",162],["1970-01-01T00:00:00.009000163Z","C",163],["1970-01-01T00:00:00.009000164Z","C",164],["1970-01-01T00:00:00.009000165Z","C",165],["1970-01-01T00:00:00.009000166Z","C",166],["1970-01-01T00:00:00.009000167Z","C",167],["1970-01-01T00:00:00.009000168Z","C",168],["1970-01-01T00:00:00.009000169Z","C",169],["1970-01-01T00:00:00.00900017Z","C",170],["1970-01-01T00:00:00.009000171Z","C",171],["1970-01-01T00:00:00.009000172Z","C",172],["1970-01-01T00:00:00.009000173Z","C",173],["1970-01-01T00:00:00.009000174Z","C",174],["1970-01-01T00:00:00.009000175Z","C",175],["1970-01-01T00:00:00.009000176Z","C",176],["1970-01-01T00:00:00.009000177Z","C",177],["1970-01-01T00:00:00.009000178Z","C",178],["1970-01-01T00:00:00.009000179Z","C",179],["1970-01-01T00:00:00.00900018Z","C",180],["1970-01-01T00:00:00.009000181Z","C",181],["1970-01-01T00:00:00.009000182Z","C",182],["1970-01-01T00:00:00.009000183Z","C",183],["1970-01-01T00:00:00.009000184Z","C",184],["1970-01-01T00:00:00.009000185Z","C",185],["1970-01-01T00:00:00.009000186Z","C",186],["1970-01-01T00:00:00.009000187Z","C",187],["1970-01-01T00:00:00.009000188Z","C",188],["1970-01-01T00:00:00.009000189Z","C",189],["1970-01-01T00:00:00.00900019Z","C",190],["1970-01-01T00:00:00.009000191Z","C",191],["1970-01-01T00:00:00.009000192Z","C",192],["1970-01-01T00:00:00.009000193Z","C",193],["1970-01-01T00:00:00.009000194Z","C",194],["1970-01-01T00:00:00.009000195Z","C",195],["1970-01-01T00:00:00.009000196Z","C",196],["1970-01-01T00:00:00.009000197Z","C",197],["1970-01-01T00:00:00.009000198Z","C",198],["1970-01-01T00:00:00.009000199Z","C",199],["1970-01-01T00:00:00.0090002Z","C",200],["1970-01-01T00:00:00.009000201Z","C",201],["1970-01-01T00:00:00.009000202Z","C",202],["1970-01-01T00:00:00.009000203Z","C",203],["1970-01-01T00:00:00.009000204Z","C",204],["1970-01-01T00:00:00.009000205Z","C",205],["1970-01-01T00:00:00.009000206Z","C",206],["1970-01-01T00:00:00.009000207Z","C",207],["1970-01-01T00:00:00.009000208Z","C",208],["1970-01-01T00:00:00.009000209Z","C",209],["1970-01-01T00:00:00.00900021Z","C",210],["1970-01-01T00:00:00.009000211Z","C",211],["1970-01-01T00:00:00.009000212Z","C",212],["1970-01-01T00:00:00.009000213Z","C",213],["1970-01-01T00:00:00.009000214Z","C",214],["1970-01-01T00:00:00.009000215Z","C",215],["1970-01-01T00:00:00.009000216Z","C",216],["1970-01-01T00:00:00.009000217Z","C",217],["1970-01-01T00:00:00.009000218Z","C",218],["1970-01-01T00:00:00.009000219Z","C",219],["1970-01-01T00:00:00.00900022Z","C",220],["1970-01-01T00:00:00.009000221Z","C",221],["1970-01-01T00:00:00.009000222Z","C",222],["1970-01-01T00:00:00.009000223Z","C",223],["1970-01-01T00:00:00.009000224Z","C",224],["1970-01-01T00:00:00.009000225Z","C",225],["1970-01-01T00:00:00.009000226Z","C",226],["1970-01-01T00:00:00.009000227Z","C",227],["1970-01-01T00:00:00.009000228Z","C",228],["1970-01-01T00:00:00.009000229Z","C",229],["1970-01-01T00:00:00.00900023Z","C",230],["1970-01-01T00:00:00.009000231Z","C",231],["1970-01-01T00:00:00.009000232Z","C",232],["1970-01-01T00:00:00.009000233Z","C",233],["1970-01-01T00:00:00.009000234Z","C",234],["1970-01-01T00:00:00.009000235Z","C",235],["1970-01-01T00:00:00.009000236Z","C",236],["1970-01-01T00:00:00.009000237Z","C",237],["1970-01-01T00:00:00.009000238Z","C",238],["1970-01-01T00:00:00.009000239Z","C",239],["1970-01-01T00:00:00.00900024Z","C",240],["1970-01-01T00:00:00.009000241Z","C",241],["1970-01-01T00:00:00.009000242Z","C",242],["1970-01-01T00:00:00.009000243Z","C",243],["1970-01-01T00:00:00.009000244Z","C",244],["1970-01-01T00:00:00.009000245Z","C",245],["1970-01-01T00:00:00.009000246Z","C",246],["1970-01-01T00:00:00.009000247Z","C",247],["1970-01-01T00:00:00.009000248Z","C",248],["1970-01-01T00:00:00.009000249Z","C",249],["1970-01-01T00:00:00.00900025Z","C",250],["1970-01-01T00:00:00.009000251Z","C",251],["1970-01-01T00:00:00.009000252Z","C",252],["1970-01-01T00:00:00.009000253Z","C",253],["1970-01-01T00:00:00.009000254Z","C",254],["1970-01-01T00:00:00.009000255Z","C",255],["1970-01-01T00:00:00.009000256Z","C",256],["1970-01-01T00:00:00.009000257Z","C",257],["1970-01-01T00:00:00.009000258Z","C",258],["1970-01-01T00:00:00.009000259Z","C",259],["1970-01-01T00:00:00.00900026Z","C",260],["1970-01-01T00:00:00.009000261Z","C",261],["1970-01-01T00:00:00.009000262Z","C",262],["1970-01-01T00:00:00.009000263Z","C",263],["1970-01-01T00:00:00.009000264Z","C",264],["1970-01-01T00:00:00.009000265Z","C",265],["1970-01-01T00:00:00.009000266Z","C",266],["1970-01-01T00:00:00.009000267Z","C",267],["1970-01-01T00:00:00.009000268Z","C",268],["1970-01-01T00:00:00.009000269Z","C",269],["1970-01-01T00:00:00.00900027Z","C",270],["1970-01-01T00:00:00.009000271Z","C",271],["1970-01-01T00:00:00.009000272Z","C",272],["1970-01-01T00:00:00.009000273Z","C",273],["1970-01-01T00:00:00.009000274Z","C",274],["1970-01-01T00:00:00.009000275Z","C",275],["1970-01-01T00:00:00.009000276Z","C",276],["1970-01-01T00:00:00.009000277Z","C",277],["1970-01-01T00:00:00.009000278Z","C",278],["1970-01-01T00:00:00.009000279Z","C",279],["1970-01-01T00:00:00.00900028Z","C",280],["1970-01-01T00:00:00.009000281Z","C",281],["1970-01-01T00:00:00.009000282Z","C",282],["1970-01-01T00:00:00.009000283Z","C",283],["1970-01-01T00:00:00.009000284Z","C",284],["1970-01-01T00:00:00.009000285Z","C",285],["1970-01-01T00:00:00.009000286Z","C",286],["1970-01-01T00:00:00.009000287Z","C",287],["1970-01-01T00:00:00.009000288Z","C",288],["1970-01-01T00:00:00.009000289Z","C",289],["1970-01-01T00:00:00.00900029Z","C",290],["1970-01-01T00:00:00.009000291Z","C",291],["1970-01-01T00:00:00.009000292Z","C",292],["1970-01-01T00:00:00.009000293Z","C",293],["1970-01-01T00:00:00.009000294Z","C",294],["1970-01-01T00:00:00.009000295Z","C",295],["1970-01-01T00:00:00.009000296Z","C",296],["1970-01-01T00:00:00.009000297Z","C",297],["1970-01-01T00:00:00.009000298Z","C",298],["1970-01-01T00:00:00.009000299Z","C",299],["1970-01-01T00:00:00.0090003Z","C",300],["1970-01-01T00:00:00.009000301Z","C",301],["1970-01-01T00:00:00.009000302Z","C",302],["1970-01-01T00:00:00.009000303Z","C",303],["1970-01-01T00:00:00.009000304Z","C",304],["1970-01-01T00:00:00.009000305Z","C",305],["1970-01-01T00:00:00.009000306Z","C",306],["1970-01-01T00:00:00.009000307Z","C",307],["1970-01-01T00:00:00.009000308Z","C",308],["1970-01-01T00:00:00.009000309Z","C",309],["1970-01-01T00:00:00.00900031Z","C",310],["1970-01-01T00:00:00.009000311Z","C",311],["1970-01-01T00:00:00.009000312Z","C",312],["1970-01-01T00:00:00.009000313Z","C",313],["1970-01-01T00:00:00.009000314Z","C",314],["1970-01-01T00:00:00.009000315Z","C",315],["1970-01-01T00:00:00.009000316Z","C",316],["1970-01-01T00:00:00.009000317Z","C",317],["1970-01-01T00:00:00.009000318Z","C",318],["1970-01-01T00:00:00.009000319Z","C",319],["1970-01-01T00:00:00.00900032Z","C",320],["1970-01-01T00:00:00.009000321Z","C",321],["1970-01-01T00:00:00.009000322Z","C",322],["1970-01-01T00:00:00.009000323Z","C",323],["1970-01-01T00:00:00.009000324Z","C",324],["1970-01-01T00:00:00.009000325Z","C",325],["1970-01-01T00:00:00.009000326Z","C",326],["1970-01-01T00:00:00.009000327Z","C",327],["1970-01-01T00:00:00.009000328Z","C",328],["1970-01-01T00:00:00.009000329Z","C",329],["1970-01-01T00:00:00.00900033Z","C",330],["1970-01-01T00:00:00.009000331Z","C",331],["1970-01-01T00:00:00.009000332Z","C",332],["1970-01-01T00:00:00.009000333Z","C",333],["1970-01-01T00:00:00.009000334Z","C",334],["1970-01-01T00:00:00.009000335Z","C",335],["1970-01-01T00:00:00.009000336Z","C",336],["1970-01-01T00:00:00.009000337Z","C",337],["1970-01-01T00:00:00.009000338Z","C",338],["1970-01-01T00:00:00.009000339Z","C",339],["1970-01-01T00:00:00.00900034Z","C",340],["1970-01-01T00:00:00.009000341Z","C",341],["1970-01-01T00:00:00.009000342Z","C",342],["1970-01-01T00:00:00.009000343Z","C",343],["1970-01-01T00:00:00.009000344Z","C",344],["1970-01-01T00:00:00.009000345Z","C",345],["1970-01-01T00:00:00.009000346Z","C",346],["1970-01-01T00:00:00.009000347Z","C",347],["1970-01-01T00:00:00.009000348Z","C",348],["1970-01-01T00:00:00.009000349Z","C",349],["1970-01-01T00:00:00.00900035Z","C",350],["1970-01-01T00:00:00.009000351Z","C",351],["1970-01-01T00:00:00.009000352Z","C",352],["1970-01-01T00:00:00.009000353Z","C",353],["1970-01-01T00:00:00.009000354Z","C",354],["1970-01-01T00:00:00.009000355Z","C",355],["1970-01-01T00:00:00.009000356Z","C",356],["1970-01-01T00:00:00.009000357Z","C",357],["1970-01-01T00:00:00.009000358Z","C",358],["1970-01-01T00:00:00.009000359Z","C",359],["1970-01-01T00:00:00.00900036Z","C",360],["1970-01-01T00:00:00.009000361Z","C",361],["1970-01-01T00:00:00.009000362Z","C",362],["1970-01-01T00:00:00.009000363Z","C",363],["1970-01-01T00:00:00.009000364Z","C",364],["1970-01-01T00:00:00.009000365Z","C",365],["1970-01-01T00:00:00.009000366Z","C",366],["1970-01-01T00:00:00.009000367Z","C",367],["1970-01-01T00:00:00.009000368Z","C",368],["1970-01-01T00:00:00.009000369Z","C",369],["1970-01-01T00:00:00.00900037Z","C",370],["1970-01-01T00:00:00.009000371Z","C",371],["1970-01-01T00:00:00.009000372Z","C",372],["1970-01-01T00:00:00.009000373Z","C",373],["1970-01-01T00:00:00.009000374Z","C",374],["1970-01-01T00:00:00.009000375Z","C",375],["1970-01-01T00:00:00.009000376Z","C",376],["1970-01-01T00:00:00.009000377Z","C",377],["1970-01-01T00:00:00.009000378Z","C",378],["1970-01-01T00:00:00.009000379Z","C",379],["1970-01-01T00:00:00.00900038Z","C",380],["1970-01-01T00:00:00.009000381Z","C",381],["1970-01-01T00:00:00.009000382Z","C",382],["1970-01-01T00:00:00.009000383Z","C",383],["1970-01-01T00:00:00.009000384Z","C",384],["1970-01-01T00:00:00.009000385Z","C",385],["1970-01-01T00:00:00.009000386Z","C",386],["1970-01-01T00:00:00.009000387Z","C",387],["1970-01-01T00:00:00.009000388Z","C",388],["1970-01-01T00:00:00.009000389Z","C",389],["1970-01-01T00:00:00.00900039Z","C",390],["1970-01-01T00:00:00.009000391Z","C",391],["1970-01-01T00:00:00.009000392Z","C",392],["1970-01-01T00:00:00.009000393Z","C",393],["1970-01-01T00:00:00.009000394Z","C",394],["1970-01-01T00:00:00.009000395Z","C",395],["1970-01-01T00:00:00.009000396Z","C",396],["1970-01-01T00:00:00.009000397Z","C",397],["1970-01-01T00:00:00.009000398Z","C",398],["1970-01-01T00:00:00.009000399Z","C",399],["1970-01-01T00:00:00.0090004Z","C",400],["1970-01-01T00:00:00.009000401Z","C",401],["1970-01-01T00:00:00.009000402Z","C",402],["1970-01-01T00:00:00.009000403Z","C",403],["1970-01-01T00:00:00.009000404Z","C",404],["1970-01-01T00:00:00.009000405Z","C",405],["1970-01-01T00:00:00.009000406Z","C",406],["1970-01-01T00:00:00.009000407Z","C",407],["1970-01-01T00:00:00.009000408Z","C",408],["1970-01-01T00:00:00.009000409Z","C",409],["1970-01-01T00:00:00.00900041Z","C",410],["1970-01-01T00:00:00.009000411Z","C",411],["1970-01-01T00:00:00.009000412Z","C",412],["1970-01-01T00:00:00.009000413Z","C",413],["1970-01-01T00:00:00.009000414Z","C",414],["1970-01-01T00:00:00.009000415Z","C",415],["1970-01-01T00:00:00.009000416Z","C",416],["1970-01-01T00:00:00.009000417Z","C",417],["1970-01-01T00:00:00.009000418Z","C",418],["1970-01-01T00:00:00.009000419Z","C",419],["1970-01-01T00:00:00.00900042Z","C",420],["1970-01-01T00:00:00.009000421Z","C",421],["1970-01-01T00:00:00.009000422Z","C",422],["1970-01-01T00:00:00.009000423Z","C",423],["1970-01-01T00:00:00.009000424Z","C",424],["1970-01-01T00:00:00.009000425Z","C",425],["1970-01-01T00:00:00.009000426Z","C",426],["1970-01-01T00:00:00.009000427Z","C",427],["1970-01-01T00:00:00.009000428Z","C",428],["1970-01-01T00:00:00.009000429Z","C",429],["1970-01-01T00:00:00.00900043Z","C",430],["1970-01-01T00:00:00.009000431Z","C",431],["1970-01-01T00:00:00.009000432Z","C",432],["1970-01-01T00:00:00.009000433Z","C",433],["1970-01-01T00:00:00.009000434Z","C",434],["1970-01-01T00:00:00.009000435Z","C",435],["1970-01-01T00:00:00.009000436Z","C",436],["1970-01-01T00:00:00.009000437Z","C",437],["1970-01-01T00:00:00.009000438Z","C",438],["1970-01-01T00:00:00.009000439Z","C",439],["1970-01-01T00:00:00.00900044Z","C",440],["1970-01-01T00:00:00.009000441Z","C",441],["1970-01-01T00:00:00.009000442Z","C",442],["1970-01-01T00:00:00.009000443Z","C",443],["1970-01-01T00:00:00.009000444Z","C",444],["1970-01-01T00:00:00.009000445Z","C",445],["1970-01-01T00:00:00.009000446Z","C",446],["1970-01-01T00:00:00.009000447Z","C",447],["1970-01-01T00:00:00.009000448Z","C",448],["1970-01-01T00:00:00.009000449Z","C",449],["1970-01-01T00:00:00.00900045Z","C",450],["1970-01-01T00:00:00.009000451Z","C",451],["1970-01-01T00:00:00.009000452Z","C",452],["1970-01-01T00:00:00.009000453Z","C",453],["1970-01-01T00:00:00.009000454Z","C",454],["1970-01-01T00:00:00.009000455Z","C",455],["1970-01-01T00:00:00.009000456Z","C",456],["1970-01-01T00:00:00.009000457Z","C",457],["1970-01-01T00:00:00.009000458Z","C",458],["1970-01-01T00:00:00.009000459Z","C",459],["1970-01-01T00:00:00.00900046Z","C",460],["1970-01-01T00:00:00.009000461Z","C",461],["1970-01-01T00:00:00.009000462Z","C",462],["1970-01-01T00:00:00.009000463Z","C",463],["1970-01-01T00:00:00.009000464Z","C",464],["1970-01-01T00:00:00.009000465Z","C",465],["1970-01-01T00:00:00.009000466Z","C",466],["1970-01-01T00:00:00.009000467Z","C",467],["1970-01-01T00:00:00.009000468Z","C",468],["1970-01-01T00:00:00.009000469Z","C",469],["1970-01-01T00:00:00.00900047Z","C",470],["1970-01-01T00:00:00.009000471Z","C",471],["1970-01-01T00:00:00.009000472Z","C",472],["1970-01-01T00:00:00.009000473Z","C",473],["1970-01-01T00:00:00.009000474Z","C",474],["1970-01-01T00:00:00.009000475Z","C",475],["1970-01-01T00:00:00.009000476Z","C",476],["1970-01-01T00:00:00.009000477Z","C",477],["1970-01-01T00:00:00.009000478Z","C",478],["1970-01-01T00:00:00.009000479Z","C",479],["1970-01-01T00:00:00.00900048Z","C",480],["1970-01-01T00:00:00.009000481Z","C",481],["1970-01-01T00:00:00.009000482Z","C",482],["1970-01-01T00:00:00.009000483Z","C",483],["1970-01-01T00:00:00.009000484Z","C",484],["1970-01-01T00:00:00.009000485Z","C",485],["1970-01-01T00:00:00.009000486Z","C",486],["1970-01-01T00:00:00.009000487Z","C",487],["1970-01-01T00:00:00.009000488Z","C",488],["1970-01-01T00:00:00.009000489Z","C",489],["1970-01-01T00:00:00.00900049Z","C",490],["1970-01-01T00:00:00.009000491Z","C",491],["1970-01-01T00:00:00.009000492Z","C",492],["1970-01-01T00:00:00.009000493Z","C",493],["1970-01-01T00:00:00.009000494Z","C",494],["1970-01-01T00:00:00.009000495Z","C",495],["1970-01-01T00:00:00.009000496Z","C",496],["1970-01-01T00:00:00.009000497Z","C",497],["1970-01-01T00:00:00.009000498Z","C",498],["1970-01-01T00:00:00.009000499Z","C",499],["1970-01-01T00:00:00.0090005Z","C",500],["1970-01-01T00:00:00.009000501Z","C",501],["1970-01-01T00:00:00.009000502Z","C",502],["1970-01-01T00:00:00.009000503Z","C",503],["1970-01-01T00:00:00.009000504Z","C",504],["1970-01-01T00:00:00.009000505Z","C",505],["1970-01-01T00:00:00.009000506Z","C",506],["1970-01-01T00:00:00.009000507Z","C",507],["1970-01-01T00:00:00.009000508Z","C",508],["1970-01-01T00:00:00.009000509Z","C",509],["1970-01-01T00:00:00.00900051Z","C",510],["1970-01-01T00:00:00.009000511Z","C",511],["1970-01-01T00:00:00.009000512Z","C",512],["1970-01-01T00:00:00.009000513Z","C",513],["1970-01-01T00:00:00.009000514Z","C",514],["1970-01-01T00:00:00.009000515Z","C",515],["1970-01-01T00:00:00.009000516Z","C",516],["1970-01-01T00:00:00.009000517Z","C",517],["1970-01-01T00:00:00.009000518Z","C",518],["1970-01-01T00:00:00.009000519Z","C",519],["1970-01-01T00:00:00.00900052Z","C",520],["1970-01-01T00:00:00.009000521Z","C",521],["1970-01-01T00:00:00.009000522Z","C",522],["1970-01-01T00:00:00.009000523Z","C",523],["1970-01-01T00:00:00.009000524Z","C",524],["1970-01-01T00:00:00.009000525Z","C",525],["1970-01-01T00:00:00.009000526Z","C",526],["1970-01-01T00:00:00.009000527Z","C",527],["1970-01-01T00:00:00.009000528Z","C",528],["1970-01-01T00:00:00.009000529Z","C",529],["1970-01-01T00:00:00.00900053Z","C",530],["1970-01-01T00:00:00.009000531Z","C",531],["1970-01-01T00:00:00.009000532Z","C",532],["1970-01-01T00:00:00.009000533Z","C",533],["1970-01-01T00:00:00.009000534Z","C",534],["1970-01-01T00:00:00.009000535Z","C",535],["1970-01-01T00:00:00.009000536Z","C",536],["1970-01-01T00:00:00.009000537Z","C",537],["1970-01-01T00:00:00.009000538Z","C",538],["1970-01-01T00:00:00.009000539Z","C",539],["1970-01-01T00:00:00.00900054Z","C",540],["1970-01-01T00:00:00.009000541Z","C",541],["1970-01-01T00:00:00.009000542Z","C",542],["1970-01-01T00:00:00.009000543Z","C",543],["1970-01-01T00:00:00.009000544Z","C",544],["1970-01-01T00:00:00.009000545Z","C",545],["1970-01-01T00:00:00.009000546Z","C",546],["1970-01-01T00:00:00.009000547Z","C",547],["1970-01-01T00:00:00.009000548Z","C",548],["1970-01-01T00:00:00.009000549Z","C",549],["1970-01-01T00:00:00.00900055Z","C",550],["1970-01-01T00:00:00.009000551Z","C",551],["1970-01-01T00:00:00.009000552Z","C",552],["1970-01-01T00:00:00.009000553Z","C",553],["1970-01-01T00:00:00.009000554Z","C",554],["1970-01-01T00:00:00.009000555Z","C",555],["1970-01-01T00:00:00.009000556Z","C",556],["1970-01-01T00:00:00.009000557Z","C",557],["1970-01-01T00:00:00.009000558Z","C",558],["1970-01-01T00:00:00.009000559Z","C",559],["1970-01-01T00:00:00.00900056Z","C",560],["1970-01-01T00:00:00.009000561Z","C",561],["1970-01-01T00:00:00.009000562Z","C",562],["1970-01-01T00:00:00.009000563Z","C",563],["1970-01-01T00:00:00.009000564Z","C",564],["1970-01-01T00:00:00.009000565Z","C",565],["1970-01-01T00:00:00.009000566Z","C",566],["1970-01-01T00:00:00.009000567Z","C",567],["1970-01-01T00:00:00.009000568Z","C",568],["1970-01-01T00:00:00.009000569Z","C",569],["1970-01-01T00:00:00.00900057Z","C",570],["1970-01-01T00:00:00.009000571Z","C",571],["1970-01-01T00:00:00.009000572Z","C",572],["1970-01-01T00:00:00.009000573Z","C",573],["1970-01-01T00:00:00.009000574Z","C",574],["1970-01-01T00:00:00.009000575Z","C",575],["1970-01-01T00:00:00.009000576Z","C",576],["1970-01-01T00:00:00.009000577Z","C",577],["1970-01-01T00:00:00.009000578Z","C",578],["1970-01-01T00:00:00.009000579Z","C",579],["1970-01-01T00:00:00.00900058Z","C",580],["1970-01-01T00:00:00.009000581Z","C",581],["1970-01-01T00:00:00.009000582Z","C",582],["1970-01-01T00:00:00.009000583Z","C",583],["1970-01-01T00:00:00.009000584Z","C",584],["1970-01-01T00:00:00.009000585Z","C",585],["1970-01-01T00:00:00.009000586Z","C",586],["1970-01-01T00:00:00.009000587Z","C",587],["1970-01-01T00:00:00.009000588Z","C",588],["1970-01-01T00:00:00.009000589Z","C",589],["1970-01-01T00:00:00.00900059Z","C",590],["1970-01-01T00:00:00.009000591Z","C",591],["1970-01-01T00:00:00.009000592Z","C",592],["1970-01-01T00:00:00.009000593Z","C",593],["1970-01-01T00:00:00.009000594Z","C",594],["1970-01-01T00:00:00.009000595Z","C",595],["1970-01-01T00:00:00.009000596Z","C",596],["1970-01-01T00:00:00.009000597Z","C",597],["1970-01-01T00:00:00.009000598Z","C",598],["1970-01-01T00:00:00.009000599Z","C",599],["1970-01-01T00:00:00.0090006Z","C",600],["1970-01-01T00:00:00.009000601Z","C",601],["1970-01-01T00:00:00.009000602Z","C",602],["1970-01-01T00:00:00.009000603Z","C",603],["1970-01-01T00:00:00.009000604Z","C",604],["1970-01-01T00:00:00.009000605Z","C",605],["1970-01-01T00:00:00.009000606Z","C",606],["1970-01-01T00:00:00.009000607Z","C",607],["1970-01-01T00:00:00.009000608Z","C",608],["1970-01-01T00:00:00.009000609Z","C",609],["1970-01-01T00:00:00.00900061Z","C",610],["1970-01-01T00:00:00.009000611Z","C",611],["1970-01-01T00:00:00.009000612Z","C",612],["1970-01-01T00:00:00.009000613Z","C",613],["1970-01-01T00:00:00.009000614Z","C",614],["1970-01-01T00:00:00.009000615Z","C",615],["1970-01-01T00:00:00.009000616Z","C",616],["1970-01-01T00:00:00.009000617Z","C",617],["1970-01-01T00:00:00.009000618Z","C",618],["1970-01-01T00:00:00.009000619Z","C",619],["1970-01-01T00:00:00.00900062Z","C",620],["1970-01-01T00:00:00.009000621Z","C",621],["1970-01-01T00:00:00.009000622Z","C",622],["1970-01-01T00:00:00.009000623Z","C",623],["1970-01-01T00:00:00.009000624Z","C",624],["1970-01-01T00:00:00.009000625Z","C",625],["1970-01-01T00:00:00.009000626Z","C",626],["1970-01-01T00:00:00.009000627Z","C",627],["1970-01-01T00:00:00.009000628Z","C",628],["1970-01-01T00:00:00.009000629Z","C",629],["1970-01-01T00:00:00.00900063Z","C",630],["1970-01-01T00:00:00.009000631Z","C",631],["1970-01-01T00:00:00.009000632Z","C",632],["1970-01-01T00:00:00.009000633Z","C",633],["1970-01-01T00:00:00.009000634Z","C",634],["1970-01-01T00:00:00.009000635Z","C",635],["1970-01-01T00:00:00.009000636Z","C",636],["1970-01-01T00:00:00.009000637Z","C",637],["1970-01-01T00:00:00.009000638Z","C",638],["1970-01-01T00:00:00.009000639Z","C",639],["1970-01-01T00:00:00.00900064Z","C",640],["1970-01-01T00:00:00.009000641Z","C",641],["1970-01-01T00:00:00.009000642Z","C",642],["1970-01-01T00:00:00.009000643Z","C",643],["1970-01-01T00:00:00.009000644Z","C",644],["1970-01-01T00:00:00.009000645Z","C",645],["1970-01-01T00:00:00.009000646Z","C",646],["1970-01-01T00:00:00.009000647Z","C",647],["1970-01-01T00:00:00.009000648Z","C",648],["1970-01-01T00:00:00.009000649Z","C",649],["1970-01-01T00:00:00.00900065Z","C",650],["1970-01-01T00:00:00.009000651Z","C",651],["1970-01-01T00:00:00.009000652Z","C",652],["1970-01-01T00:00:00.009000653Z","C",653],["1970-01-01T00:00:00.009000654Z","C",654],["1970-01-01T00:00:00.009000655Z","C",655],["1970-01-01T00:00:00.009000656Z","C",656],["1970-01-01T00:00:00.009000657Z","C",657],["1970-01-01T00:00:00.009000658Z","C",658],["1970-01-01T00:00:00.009000659Z","C",659],["1970-01-01T00:00:00.00900066Z","C",660],["1970-01-01T00:00:00.009000661Z","C",661],["1970-01-01T00:00:00.009000662Z","C",662],["1970-01-01T00:00:00.009000663Z","C",663],["1970-01-01T00:00:00.009000664Z","C",664],["1970-01-01T00:00:00.009000665Z","C",665],["1970-01-01T00:00:00.009000666Z","C",666],["1970-01-01T00:00:00.009000667Z","C",667],["1970-01-01T00:00:00.009000668Z","C",668],["1970-01-01T00:00:00.009000669Z","C",669],["1970-01-01T00:00:00.00900067Z","C",670],["1970-01-01T00:00:00.009000671Z","C",671],["1970-01-01T00:00:00.009000672Z","C",672],["1970-01-01T00:00:00.009000673Z","C",673],["1970-01-01T00:00:00.009000674Z","C",674],["1970-01-01T00:00:00.009000675Z","C",675],["1970-01-01T00:00:00.009000676Z","C",676],["1970-01-01T00:00:00.009000677Z","C",677],["1970-01-01T00:00:00.009000678Z","C",678],["1970-01-01T00:00:00.009000679Z","C",679],["1970-01-01T00:00:00.00900068Z","C",680],["1970-01-01T00:00:00.009000681Z","C",681],["1970-01-01T00:00:00.009000682Z","C",682],["1970-01-01T00:00:00.009000683Z","C",683],["1970-01-01T00:00:00.009000684Z","C",684],["1970-01-01T00:00:00.009000685Z","C",685],["1970-01-01T00:00:00.009000686Z","C",686],["1970-01-01T00:00:00.009000687Z","C",687],["1970-01-01T00:00:00.009000688Z","C",688],["1970-01-01T00:00:00.009000689Z","C",689],["1970-01-01T00:00:00.00900069Z","C",690],["1970-01-01T00:00:00.009000691Z","C",691],["1970-01-01T00:00:00.009000692Z","C",692],["1970-01-01T00:00:00.009000693Z","C",693],["1970-01-01T00:00:00.009000694Z","C",694],["1970-01-01T00:00:00.009000695Z","C",695],["1970-01-01T00:00:00.009000696Z","C",696],["1970-01-01T00:00:00.009000697Z","C",697],["1970-01-01T00:00:00.009000698Z","C",698],["1970-01-01T00:00:00.009000699Z","C",699],["1970-01-01T00:00:00.0090007Z","C",700],["1970-01-01T00:00:00.009000701Z","C",701],["1970-01-01T00:00:00.009000702Z","C",702],["1970-01-01T00:00:00.009000703Z","C",703],["1970-01-01T00:00:00.009000704Z","C",704],["1970-01-01T00:00:00.009000705Z","C",705],["1970-01-01T00:00:00.009000706Z","C",706],["1970-01-01T00:00:00.009000707Z","C",707],["1970-01-01T00:00:00.009000708Z","C",708],["1970-01-01T00:00:00.009000709Z","C",709],["1970-01-01T00:00:00.00900071Z","C",710],["1970-01-01T00:00:00.009000711Z","C",711],["1970-01-01T00:00:00.009000712Z","C",712],["1970-01-01T00:00:00.009000713Z","C",713],["1970-01-01T00:00:00.009000714Z","C",714],["1970-01-01T00:00:00.009000715Z","C",715],["1970-01-01T00:00:00.009000716Z","C",716],["1970-01-01T00:00:00.009000717Z","C",717],["1970-01-01T00:00:00.009000718Z","C",718],["1970-01-01T00:00:00.009000719Z","C",719],["1970-01-01T00:00:00.00900072Z","C",720],["1970-01-01T00:00:00.009000721Z","C",721],["1970-01-01T00:00:00.009000722Z","C",722],["1970-01-01T00:00:00.009000723Z","C",723],["1970-01-01T00:00:00.009000724Z","C",724],["1970-01-01T00:00:00.009000725Z","C",725],["1970-01-01T00:00:00.009000726Z","C",726],["1970-01-01T00:00:00.009000727Z","C",727],["1970-01-01T00:00:00.009000728Z","C",728],["1970-01-01T00:00:00.009000729Z","C",729],["1970-01-01T00:00:00.00900073Z","C",730],["1970-01-01T00:00:00.009000731Z","C",731],["1970-01-01T00:00:00.009000732Z","C",732],["1970-01-01T00:00:00.009000733Z","C",733],["1970-01-01T00:00:00.009000734Z","C",734],["1970-01-01T00:00:00.009000735Z","C",735],["1970-01-01T00:00:00.009000736Z","C",736],["1970-01-01T00:00:00.009000737Z","C",737],["1970-01-01T00:00:00.009000738Z","C",738],["1970-01-01T00:00:00.009000739Z","C",739],["1970-01-01T00:00:00.00900074Z","C",740],["1970-01-01T00:00:00.009000741Z","C",741],["1970-01-01T00:00:00.009000742Z","C",742],["1970-01-01T00:00:00.009000743Z","C",743],["1970-01-01T00:00:00.009000744Z","C",744],["1970-01-01T00:00:00.009000745Z","C",745],["1970-01-01T00:00:00.009000746Z","C",746],["1970-01-01T00:00:00.009000747Z","C",747],["1970-01-01T00:00:00.009000748Z","C",748],["1970-01-01T00:00:00.009000749Z","C",749],["1970-01-01T00:00:00.00900075Z","C",750],["1970-01-01T00:00:00.009000751Z","C",751],["1970-01-01T00:00:00.009000752Z","C",752],["1970-01-01T00:00:00.009000753Z","C",753],["1970-01-01T00:00:00.009000754Z","C",754],["1970-01-01T00:00:00.009000755Z","C",755],["1970-01-01T00:00:00.009000756Z","C",756],["1970-01-01T00:00:00.009000757Z","C",757],["1970-01-01T00:00:00.009000758Z","C",758],["1970-01-01T00:00:00.009000759Z","C",759],["1970-01-01T00:00:00.00900076Z","C",760],["1970-01-01T00:00:00.009000761Z","C",761],["1970-01-01T00:00:00.009000762Z","C",762],["1970-01-01T00:00:00.009000763Z","C",763],["1970-01-01T00:00:00.009000764Z","C",764],["1970-01-01T00:00:00.009000765Z","C",765],["1970-01-01T00:00:00.009000766Z","C",766],["1970-01-01T00:00:00.009000767Z","C",767],["1970-01-01T00:00:00.009000768Z","C",768],["1970-01-01T00:00:00.009000769Z","C",769],["1970-01-01T00:00:00.00900077Z","C",770],["1970-01-01T00:00:00.009000771Z","C",771],["1970-01-01T00:00:00.009000772Z","C",772],["1970-01-01T00:00:00.009000773Z","C",773],["1970-01-01T00:00:00.009000774Z","C",774],["1970-01-01T00:00:00.009000775Z","C",775],["1970-01-01T00:00:00.009000776Z","C",776],["1970-01-01T00:00:00.009000777Z","C",777],["1970-01-01T00:00:00.009000778Z","C",778],["1970-01-01T00:00:00.009000779Z","C",779],["1970-01-01T00:00:00.00900078Z","C",780],["1970-01-01T00:00:00.009000781Z","C",781],["1970-01-01T00:00:00.009000782Z","C",782],["1970-01-01T00:00:00.009000783Z","C",783],["1970-01-01T00:00:00.009000784Z","C",784],["1970-01-01T00:00:00.009000785Z","C",785],["1970-01-01T00:00:00.009000786Z","C",786],["1970-01-01T00:00:00.009000787Z","C",787],["1970-01-01T00:00:00.009000788Z","C",788],["1970-01-01T00:00:00.009000789Z","C",789],["1970-01-01T00:00:00.00900079Z","C",790],["1970-01-01T00:00:00.009000791Z","C",791],["1970-01-01T00:00:00.009000792Z","C",792],["1970-01-01T00:00:00.009000793Z","C",793],["1970-01-01T00:00:00.009000794Z","C",794],["1970-01-01T00:00:00.009000795Z","C",795],["1970-01-01T00:00:00.009000796Z","C",796],["1970-01-01T00:00:00.009000797Z","C",797],["1970-01-01T00:00:00.009000798Z","C",798],["1970-01-01T00:00:00.009000799Z","C",799],["1970-01-01T00:00:00.0090008Z","C",800],["1970-01-01T00:00:00.009000801Z","C",801],["1970-01-01T00:00:00.009000802Z","C",802],["1970-01-01T00:00:00.009000803Z","C",803],["1970-01-01T00:00:00.009000804Z","C",804],["1970-01-01T00:00:00.009000805Z","C",805],["1970-01-01T00:00:00.009000806Z","C",806],["1970-01-01T00:00:00.009000807Z","C",807],["1970-01-01T00:00:00.009000808Z","C",808],["1970-01-01T00:00:00.009000809Z","C",809],["1970-01-01T00:00:00.00900081Z","C",810],["1970-01-01T00:00:00.009000811Z","C",811],["1970-01-01T00:00:00.009000812Z","C",812],["1970-01-01T00:00:00.009000813Z","C",813],["1970-01-01T00:00:00.009000814Z","C",814],["1970-01-01T00:00:00.009000815Z","C",815],["1970-01-01T00:00:00.009000816Z","C",816],["1970-01-01T00:00:00.009000817Z","C",817],["1970-01-01T00:00:00.009000818Z","C",818],["1970-01-01T00:00:00.009000819Z","C",819],["1970-01-01T00:00:00.00900082Z","C",820],["1970-01-01T00:00:00.009000821Z","C",821],["1970-01-01T00:00:00.009000822Z","C",822],["1970-01-01T00:00:00.009000823Z","C",823],["1970-01-01T00:00:00.009000824Z","C",824],["1970-01-01T00:00:00.009000825Z","C",825],["1970-01-01T00:00:00.009000826Z","C",826],["1970-01-01T00:00:00.009000827Z","C",827],["1970-01-01T00:00:00.009000828Z","C",828],["1970-01-01T00:00:00.009000829Z","C",829],["1970-01-01T00:00:00.00900083Z","C",830],["1970-01-01T00:00:00.009000831Z","C",831],["1970-01-01T00:00:00.009000832Z","C",832],["1970-01-01T00:00:00.009000833Z","C",833],["1970-01-01T00:00:00.009000834Z","C",834],["1970-01-01T00:00:00.009000835Z","C",835],["1970-01-01T00:00:00.009000836Z","C",836],["1970-01-01T00:00:00.009000837Z","C",837],["1970-01-01T00:00:00.009000838Z","C",838],["1970-01-01T00:00:00.009000839Z","C",839],["1970-01-01T00:00:00.00900084Z","C",840],["1970-01-01T00:00:00.009000841Z","C",841],["1970-01-01T00:00:00.009000842Z","C",842],["1970-01-01T00:00:00.009000843Z","C",843],["1970-01-01T00:00:00.009000844Z","C",844],["1970-01-01T00:00:00.009000845Z","C",845],["1970-01-01T00:00:00.009000846Z","C",846],["1970-01-01T00:00:00.009000847Z","C",847],["1970-01-01T00:00:00.009000848Z","C",848],["1970-01-01T00:00:00.009000849Z","C",849],["1970-01-01T00:00:00.00900085Z","C",850],["1970-01-01T00:00:00.009000851Z","C",851],["1970-01-01T00:00:00.009000852Z","C",852],["1970-01-01T00:00:00.009000853Z","C",853],["1970-01-01T00:00:00.009000854Z","C",854],["1970-01-01T00:00:00.009000855Z","C",855],["1970-01-01T00:00:00.009000856Z","C",856],["1970-01-01T00:00:00.009000857Z","C",857],["1970-01-01T00:00:00.009000858Z","C",858],["1970-01-01T00:00:00.009000859Z","C",859],["1970-01-01T00:00:00.00900086Z","C",860],["1970-01-01T00:00:00.009000861Z","C",861],["1970-01-01T00:00:00.009000862Z","C",862],["1970-01-01T00:00:00.009000863Z","C",863],["1970-01-01T00:00:00.009000864Z","C",864],["1970-01-01T00:00:00.009000865Z","C",865],["1970-01-01T00:00:00.009000866Z","C",866],["1970-01-01T00:00:00.009000867Z","C",867],["1970-01-01T00:00:00.009000868Z","C",868],["1970-01-01T00:00:00.009000869Z","C",869],["1970-01-01T00:00:00.00900087Z","C",870],["1970-01-01T00:00:00.009000871Z","C",871],["1970-01-01T00:00:00.009000872Z","C",872],["1970-01-01T00:00:00.009000873Z","C",873],["1970-01-01T00:00:00.009000874Z","C",874],["1970-01-01T00:00:00.009000875Z","C",875],["1970-01-01T00:00:00.009000876Z","C",876],["1970-01-01T00:00:00.009000877Z","C",877],["1970-01-01T00:00:00.009000878Z","C",878],["1970-01-01T00:00:00.009000879Z","C",879],["1970-01-01T00:00:00.00900088Z","C",880],["1970-01-01T00:00:00.009000881Z","C",881],["1970-01-01T00:00:00.009000882Z","C",882],["1970-01-01T00:00:00.009000883Z","C",883],["1970-01-01T00:00:00.009000884Z","C",884],["1970-01-01T00:00:00.009000885Z","C",885],["1970-01-01T00:00:00.009000886Z","C",886],["1970-01-01T00:00:00.009000887Z","C",887],["1970-01-01T00:00:00.009000888Z","C",888],["1970-01-01T00:00:00.009000889Z","C",889],["1970-01-01T00:00:00.00900089Z","C",890],["1970-01-01T00:00:00.009000891Z","C",891],["1970-01-01T00:00:00.009000892Z","C",892],["1970-01-01T00:00:00.009000893Z","C",893],["1970-01-01T00:00:00.009000894Z","C",894],["1970-01-01T00:00:00.009000895Z","C",895],["1970-01-01T00:00:00.009000896Z","C",896],["1970-01-01T00:00:00.009000897Z","C",897],["1970-01-01T00:00:00.009000898Z","C",898],["1970-01-01T00:00:00.009000899Z","C",899],["1970-01-01T00:00:00.0090009Z","C",900],["1970-01-01T00:00:00.009000901Z","C",901],["1970-01-01T00:00:00.009000902Z","C",902],["1970-01-01T00:00:00.009000903Z","C",903],["1970-01-01T00:00:00.009000904Z","C",904],["1970-01-01T00:00:00.009000905Z","C",905],["1970-01-01T00:00:00.009000906Z","C",906],["1970-01-01T00:00:00.009000907Z","C",907],["1970-01-01T00:00:00.009000908Z","C",908],["1970-01-01T00:00:00.009000909Z","C",909],["1970-01-01T00:00:00.00900091Z","C",910],["1970-01-01T00:00:00.009000911Z","C",911],["1970-01-01T00:00:00.009000912Z","C",912],["1970-01-01T00:00:00.009000913Z","C",913],["1970-01-01T00:00:00.009000914Z","C",914],["1970-01-01T00:00:00.009000915Z","C",915],["1970-01-01T00:00:00.009000916Z","C",916],["1970-01-01T00:00:00.009000917Z","C",917],["1970-01-01T00:00:00.009000918Z","C",918],["1970-01-01T00:00:00.009000919Z","C",919],["1970-01-01T00:00:00.00900092Z","C",920],["1970-01-01T00:00:00.009000921Z","C",921],["1970-01-01T00:00:00.009000922Z","C",922],["1970-01-01T00:00:00.009000923Z","C",923],["1970-01-01T00:00:00.009000924Z","C",924],["1970-01-01T00:00:00.009000925Z","C",925],["1970-01-01T00:00:00.009000926Z","C",926],["1970-01-01T00:00:00.009000927Z","C",927],["1970-01-01T00:00:00.009000928Z","C",928],["1970-01-01T00:00:00.009000929Z","C",929],["1970-01-01T00:00:00.00900093Z","C",930],["1970-01-01T00:00:00.009000931Z","C",931],["1970-01-01T00:00:00.009000932Z","C",932],["1970-01-01T00:00:00.009000933Z","C",933],["1970-01-01T00:00:00.009000934Z","C",934],["1970-01-01T00:00:00.009000935Z","C",935],["1970-01-01T00:00:00.009000936Z","C",936],["1970-01-01T00:00:00.009000937Z","C",937],["1970-01-01T00:00:00.009000938Z","C",938],["1970-01-01T00:00:00.009000939Z","C",939],["1970-01-01T00:00:00.00900094Z","C",940],["1970-01-01T00:00:00.009000941Z","C",941],["1970-01-01T00:00:00.009000942Z","C",942],["1970-01-01T00:00:00.009000943Z","C",943],["1970-01-01T00:00:00.009000944Z","C",944],["1970-01-01T00:00:00.009000945Z","C",945],["1970-01-01T00:00:00.009000946Z","C",946],["1970-01-01T00:00:00.009000947Z","C",947],["1970-01-01T00:00:00.009000948Z","C",948],["1970-01-01T00:00:00.009000949Z","C",949],["1970-01-01T00:00:00.00900095Z","C",950],["1970-01-01T00:00:00.009000951Z","C",951],["1970-01-01T00:00:00.009000952Z","C",952],["1970-01-01T00:00:00.009000953Z","C",953],["1970-01-01T00:00:00.009000954Z","C",954],["1970-01-01T00:00:00.009000955Z","C",955],["1970-01-01T00:00:00.009000956Z","C",956],["1970-01-01T00:00:00.009000957Z","C",957],["1970-01-01T00:00:00.009000958Z","C",958],["1970-01-01T00:00:00.009000959Z","C",959],["1970-01-01T00:00:00.00900096Z","C",960],["1970-01-01T00:00:00.009000961Z","C",961],["1970-01-01T00:00:00.009000962Z","C",962],["1970-01-01T00:00:00.009000963Z","C",963],["1970-01-01T00:00:00.009000964Z","C",964],["1970-01-01T00:00:00.009000965Z","C",965],["1970-01-01T00:00:00.009000966Z","C",966],["1970-01-01T00:00:00.009000967Z","C",967],["1970-01-01T00:00:00.009000968Z","C",968],["1970-01-01T00:00:00.009000969Z","C",969],["1970-01-01T00:00:00.00900097Z","C",970],["1970-01-01T00:00:00.009000971Z","C",971],["1970-01-01T00:00:00.009000972Z","C",972],["1970-01-01T00:00:00.009000973Z","C",973],["1970-01-01T00:00:00.009000974Z","C",974],["1970-01-01T00:00:00.009000975Z","C",975],["1970-01-01T00:00:00.009000976Z","C",976],["1970-01-01T00:00:00.009000977Z","C",977],["1970-01-01T00:00:00.009000978Z","C",978],["1970-01-01T00:00:00.009000979Z","C",979],["1970-01-01T00:00:00.00900098Z","C",980],["1970-01-01T00:00:00.009000981Z","C",981],["1970-01-01T00:00:00.009000982Z","C",982],["1970-01-01T00:00:00.009000983Z","C",983],["1970-01-01T00:00:00.009000984Z","C",984],["1970-01-01T00:00:00.009000985Z","C",985],["1970-01-01T00:00:00.009000986Z","C",986],["1970-01-01T00:00:00.009000987Z","C",987],["1970-01-01T00:00:00.009000988Z","C",988],["1970-01-01T00:00:00.009000989Z","C",989],["1970-01-01T00:00:00.00900099Z","C",990],["1970-01-01T00:00:00.009000991Z","C",991],["1970-01-01T00:00:00.009000992Z","C",992],["1970-01-01T00:00:00.009000993Z","C",993],["1970-01-01T00:00:00.009000994Z","C",994],["1970-01-01T00:00:00.009000995Z","C",995],["1970-01-01T00:00:00.009000996Z","C",996],["1970-01-01T00:00:00.009000997Z","C",997],["1970-01-01T00:00:00.009000998Z","C",998],["1970-01-01T00:00:00.009000999Z","C",999]]}]}]}`

	// set the cache snapshot size low so that a single point will cause TSM file creation
	config.Data.CacheSnapshotMemorySize = 1

	func() {
		s := OpenServer(config)
		defer s.Close()

		if _, ok := s.(*RemoteServer); ok {
			t.Skip("Skipping.  Cannot modify remote server config")
		}

		if err := s.CreateDatabaseAndRetentionPolicy(db, NewRetentionPolicySpec(rp, 1, 0), true); err != nil {
			t.Fatal(err)
		}

		if _, err := s.Write(db, rp, "myseries,host=A value=23 1000000", nil); err != nil {
			t.Fatalf("failed to write: %s", err)
		}

		// wait for the snapshot to write
		time.Sleep(time.Second)

		if _, err := s.Write(db, rp, "myseries,host=B value=24 5000000", nil); err != nil {
			t.Fatalf("failed to write: %s", err)
		}

		// wait for the snapshot to write
		time.Sleep(time.Second)

		if _, err := s.Write(db, rp, "myseries,host=C value=22 6000000", nil); err != nil {
			t.Fatalf("failed to write: %s", err)
		}

		if _, err := s.Write(db, rp, "myseries,host=C value=23 7000000", nil); err != nil {
			t.Fatalf("failed to write: %s", err)
		}

		if _, err := s.Write(db, rp, "myseries,host=C value=24 8000000", nil); err != nil {
			t.Fatalf("failed to write: %s", err)
		}

		if _, err := s.Write(db, rp, "myseries,host=C value=25 9000000", nil); err != nil {
			t.Fatalf("failed to write: %s", err)
		}

		// wait for the snapshot to write
		time.Sleep(time.Second)

		if _, err := s.Query(`show series on mydb; show retention policies on mydb`); err != nil {
			t.Fatalf("error querying: %s", err.Error())
		}

		res, err := s.Query(`select * from "mydb"."forever"."myseries"`)
		if err != nil {
			t.Fatalf("error querying: %s", err.Error())
		}
		if res != expected {
			t.Fatalf("query results wrong:\n\texp: %s\n\tgot: %s", expected, res)
		}

		for !strings.Contains(res, "_internal") {
			res, err = s.Query(`SHOW DATABASES`)
			if err != nil {
				t.Fatalf("error querying: %s", err.Error())
			}
			// technically not necessary, but no reason to crush the CPU for polling
			time.Sleep(time.Second)
		}

		// now backup
		cmd := backup.NewCommand()
		_, port, err := net.SplitHostPort(config.BindAddress)
		if err != nil {
			t.Fatal(err)
		}
		hostAddress := net.JoinHostPort("localhost", port)
		if err := cmd.Run("-host", hostAddress, "-database", "mydb", fullBackupDir); err != nil {
			t.Fatalf("error backing up: %s, hostAddress: %s", err.Error(), hostAddress)
		}

		for i := 0; i < 2000; i++ {
			line := fmt.Sprintf("myseries,host=C value=%d %d", i, 9000000+i)
			if _, err := s.Write(db, rp, line, nil); err != nil {
				t.Fatalf("failed to write: %s", err)
			}
		}

		time.Sleep(time.Second)
		if err := cmd.Run("-host", hostAddress, "-database", "mydb", "-start", "1970-01-01T00:00:00.001Z", "-end", "1970-01-01T00:00:00.009Z", partialBackupDir); err != nil {
			t.Fatalf("error backing up: %s, hostAddress: %s", err.Error(), hostAddress)
		}

		if err := cmd.Run("-portable", "-host", hostAddress, "-database", "mydb", "-start", "1970-01-01T00:00:00.001Z", "-end", "1970-01-01T00:00:00.009Z", portableBackupDir); err != nil {
			t.Fatalf("error backing up: %s, hostAddress: %s", err.Error(), hostAddress)
		}

	}()

	if _, err := os.Stat(config.Meta.Dir); err == nil || !os.IsNotExist(err) {
		t.Fatalf("meta dir should be deleted")
	}

	if _, err := os.Stat(config.Data.Dir); err == nil || !os.IsNotExist(err) {
		t.Fatalf("meta dir should be deleted")
	}

	// if doing a real restore, these dirs should exist in the real DB.
	if err := os.MkdirAll(config.Data.Dir, 0777); err != nil {
		t.Fatalf("error making restore dir: %s", err.Error())
	}
	if err := os.MkdirAll(config.Meta.Dir, 0777); err != nil {
		t.Fatalf("error making restore dir: %s", err.Error())
	}

	// restore
	cmd := restore.NewCommand()

	if err := cmd.Run("-metadir", config.Meta.Dir, "-datadir", config.Data.Dir, "-database", "mydb", fullBackupDir); err != nil {
		t.Fatalf("error restoring: %s", err.Error())
	}

	// Make sure node.json was restored
	nodePath := filepath.Join(config.Meta.Dir, "node.json")
	if _, err := os.Stat(nodePath); err != nil || os.IsNotExist(err) {
		t.Fatalf("node.json should exist")
	}

	// now open it up and verify we're good
	s := OpenServer(config)
	defer s.Close()

	// 1.  offline restore is correct
	res, err := s.Query(`select * from "mydb"."forever"."myseries"`)
	if err != nil {
		t.Fatalf("error querying: %s", err.Error())
	}
	if res != expected {
		t.Fatalf("query results wrong:\n\texp: %s\n\tgot: %s", expected, res)
	}

	_, port, err := net.SplitHostPort(config.BindAddress)
	if err != nil {
		t.Fatal(err)
	}

	// 2.  online restore of a partial backup is correct.
	hostAddress := net.JoinHostPort("localhost", port)
	cmd.Run("-host", hostAddress, "-online", "-newdb", "mydbbak", "-db", "mydb", partialBackupDir)

	// wait for the import to finish, and unlock the shard engine.
	time.Sleep(time.Second)

	res, err = s.Query(`select * from "mydbbak"."forever"."myseries"`)
	if err != nil {
		t.Fatalf("error querying: %s", err.Error())
	}

	if res != partialExpected {
		t.Fatalf("query results wrong:\n\texp: %s\n\tgot: %s", partialExpected, res)
	}

	// 3. portable should be the same as the non-portable live restore
	cmd.Run("-host", hostAddress, "-portable", "-newdb", "mydbbak2", "-db", "mydb", portableBackupDir)

	// wait for the import to finish, and unlock the shard engine.
	time.Sleep(time.Second)

	res, err = s.Query(`select * from "mydbbak2"."forever"."myseries"`)
	if err != nil {
		t.Fatalf("error querying: %s", err.Error())
	}

	if res != partialExpected {
		t.Fatalf("query results wrong:\n\texp: %s\n\tgot: %s", partialExpected, res)
	}

	// 4.  backup all DB's, then drop them, then restore them and all 3 above tests should pass again.
	// now backup
	bCmd := backup.NewCommand()

	if err := bCmd.Run("-portable", "-host", hostAddress, portableBackupDir); err != nil {
		t.Fatalf("error backing up: %s, hostAddress: %s", err.Error(), hostAddress)
	}

	_, err = s.Query(`drop database mydb; drop database mydbbak; drop database mydbbak2;`)
	if err != nil {
		t.Fatalf("Error dropping databases %s", err.Error())
	}

	// 3. portable should be the same as the non-portable live restore
	cmd.Run("-host", hostAddress, "-portable", portableBackupDir)

	// wait for the import to finish, and unlock the shard engine.
	time.Sleep(3 * time.Second)

	res, err = s.Query(`show shards`)
	if err != nil {
		t.Fatalf("error querying: %s", err.Error())
	}
	fmt.Println(res)

	res, err = s.Query(`select * from "mydbbak"."forever"."myseries"`)
	if err != nil {
		t.Fatalf("error querying: %s", err.Error())
	}

	if res != partialExpected {
		t.Fatalf("query results wrong:\n\texp: %s\n\tgot: %s", partialExpected, res)
	}

	res, err = s.Query(`select * from "mydbbak2"."forever"."myseries"`)
	if err != nil {
		t.Fatalf("error querying: %s", err.Error())
	}

	if res != partialExpected {
		t.Fatalf("query results wrong:\n\texp: %s\n\tgot: %s", partialExpected, res)
	}

	res, err = s.Query(`select * from "mydb"."forever"."myseries"`)
	if err != nil {
		t.Fatalf("error querying: %s", err.Error())
	}
	if res != expected {
		t.Fatalf("query results wrong:\n\texp: %s\n\tgot: %s", expected, res)
	}

}

func freePort() string {
	l, _ := net.Listen("tcp", "")
	defer l.Close()
	return l.Addr().String()
}
